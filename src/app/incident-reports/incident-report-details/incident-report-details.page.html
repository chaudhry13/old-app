<ion-header>
  <ion-toolbar color="primary" class="ion-color ion-color-primary">
    <ion-title class="title-ios hydrated">Incident Report</ion-title>

    <ion-buttons slot="start">
      <ion-back-button></ion-back-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content *ngIf="incidentReport">
  <agm-map
    *ngIf="renderMap"
    #map
    [latitude]="incidentReport.latitude"
    [longitude]="incidentReport.longitude"
  >
    <agm-marker
      [latitude]="incidentReport.latitude"
      [longitude]="incidentReport.longitude"
    ></agm-marker>
  </agm-map>

  <ion-card-header>
    <ion-card-subtitle *ngIf="incidentReport.source == 0"
      >Internal</ion-card-subtitle
    >
    <ion-card-subtitle *ngIf="incidentReport.source == 1"
      >External</ion-card-subtitle
    >
    <ion-card-title>{{incidentReport.title}}</ion-card-title>
  </ion-card-header>
  <ion-card-content>
    {{incidentReport.description}}
  </ion-card-content>
  <div *ngIf="incidentReport.source == 1">
    <ion-card-header>
      <ion-card-subtitle>Risk Level</ion-card-subtitle>
    </ion-card-header>
    <ion-card-content [ngSwitch]="incidentReport.riskLevel">
      <ion-badge *ngSwitchCase="1" class="risk-low">Low (1)</ion-badge>
      <ion-badge *ngSwitchCase="2" class="risk-moderate"
        >Moderate (2)</ion-badge
      >
      <ion-badge *ngSwitchCase="3" class="risk-medium">Medium (3)</ion-badge>
      <ion-badge *ngSwitchCase="4" class="risk-high">High (4)</ion-badge>
      <ion-badge *ngSwitchCase="5" class="risk-extreme">Extreme (5)</ion-badge>
      <ion-badge *ngSwitchDefault color="primary">Internal</ion-badge>
    </ion-card-content>
    <ion-card-header>
      <ion-card-subtitle>Created</ion-card-subtitle>
    </ion-card-header>
    <ion-card-content>
      {{ incidentReport.created | date:'MMM dd, yyyy' }}
    </ion-card-content>
    <ion-card-header>
      <ion-card-subtitle>Start</ion-card-subtitle>
    </ion-card-header>
    <ion-card-content>
      {{ incidentReport.startDate | date:'MMM dd, yyyy' }}
    </ion-card-content>
    <ion-card-header>
      <ion-card-subtitle>End</ion-card-subtitle>
    </ion-card-header>
    <ion-card-content>
      {{ incidentReport.endDate | date:'MMM dd, yyyy' }}
    </ion-card-content>
    <ion-card-header *ngIf="incidentReport.source == 1">
      <ion-card-subtitle>Source</ion-card-subtitle>
    </ion-card-header>
    <ion-card-content *ngIf="incidentReport.source == 1">
      <img width="200px" src="assets/img/riskline_logo.png" />
    </ion-card-content>
  </div>

  <div *ngIf="incidentReport.source == 0">
    <ion-grid>
      <ion-row>
        <ion-col>
          <ion-button
            color="secondary"
            expand="block"
            margin-bottom
            (click)="takePhotoAndUpload()"
          >
            Take photo</ion-button
          >
        </ion-col>
      </ion-row>
    </ion-grid>
    <ion-card-header>
      <ion-card-subtitle>Reported By</ion-card-subtitle>
    </ion-card-header>
    <ion-card-content>
      {{ incidentReport.user.name }}
    </ion-card-content>
    <ion-card-header>
      <ion-card-subtitle>Created</ion-card-subtitle>
    </ion-card-header>
    <ion-card-content>
      {{ incidentReport.created | date:'MMM dd, yyyy' }}
    </ion-card-content>
    <ion-card-header>
      <ion-card-subtitle>Address</ion-card-subtitle>
    </ion-card-header>
    <ion-card-content>
      {{ incidentReport.address }}
    </ion-card-content>
    <ion-card-content *ngIf="incidentReport.city">
      {{ incidentReport.city }}
    </ion-card-content>
    <ion-card-header>
      <ion-card-subtitle>Country</ion-card-subtitle>
    </ion-card-header>
    <ion-card-content>
      {{ incidentReport.country.name }}
    </ion-card-content>
    <ion-card-header>
      <ion-card-subtitle>Divisions</ion-card-subtitle>
    </ion-card-header>
    <ion-card-content>
      <span *ngFor="let division of incidentReport.divisions; let isLast=last">
        {{ division.name }}{{isLast ? '' : ', '}}
      </span>
    </ion-card-content>
  </div>

  <ion-card-header *ngIf="files && files.length > 0">
    <ion-card-subtitle>Files</ion-card-subtitle>
  </ion-card-header>

  <ion-item *ngFor="let file of files">
    <ion-thumbnail slot="start" *ngIf="file">
      <img src="{{ file.url }}" />
    </ion-thumbnail>
    <ion-label>
      {{file.name}}
    </ion-label>
    <ion-icon
      (click)="removePicture(file)"
      name="trash"
      color="warning"
      item-end
    ></ion-icon>
  </ion-item>

  <ion-card-content style="color: lightgray; font-size: small;">
    {{ incidentReport.id }}
  </ion-card-content>
</ion-content>
